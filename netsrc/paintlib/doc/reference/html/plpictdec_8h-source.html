<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>paintlib: plpictdec.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>plpictdec.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">/--------------------------------------------------------------------</span>
00003 <span class="comment">|</span>
00004 <span class="comment">|      $Id: plpictdec_8h-source.html,v 1.4 2004/09/15 15:26:32 uzadow Exp $</span>
00005 <span class="comment">|</span>
00006 <span class="comment">|      Copyright (c) 1996-2002 Ulrich von Zadow</span>
00007 <span class="comment">|</span>
00008 <span class="comment">\--------------------------------------------------------------------</span>
00009 <span class="comment">*/</span>
00010 
00011 <span class="preprocessor">#ifndef INCL_PLPICTDEC</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define INCL_PLPICTDEC</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#ifndef INCL_PLPICDEC</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include "plpicdec.h"</span>
00016 <span class="preprocessor">#endif</span>
00017 <span class="preprocessor"></span>
00018 <span class="preprocessor">#include "<a class="code" href="qdraw_8h.html">qdraw.h</a>"</span>
00019 
00020 <span class="keyword">class </span><a class="code" href="classPLJPEGDecoder.html">PLJPEGDecoder</a>;
00021 <span class="comment"></span>
00022 <span class="comment">//! This class decodes macintosh PICT files with 1,2,4,8,16 and 32</span>
00023 <span class="comment">//! bits per pixel as well as PICT/JPEG. If an alpha channel is</span>
00024 <span class="comment">//! present in a 32-bit-PICT, it is decoded as well.</span>
00025 <span class="comment">//! The PICT format is a general picture file format and can</span>
00026 <span class="comment">//! contain a lot of other elements besides bitmaps. These elements</span>
00027 <span class="comment">//! are ignored.</span>
<a name="l00028"></a><a class="code" href="classPLPictDecoder.html">00028</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classPLPictDecoder.html">PLPictDecoder</a> : <span class="keyword">public</span> <a class="code" href="classPLPicDecoder.html">PLPicDecoder</a>
00029 {
00030 
00031 <span class="keyword">public</span>:<span class="comment"></span>
00032 <span class="comment">  //! Creates a decoder. A JPEG decoder is needed to decode PICT</span>
00033 <span class="comment">  //! files containing JPEGs.</span>
00034 <span class="comment"></span>  <a class="code" href="classPLPictDecoder.html">PLPictDecoder</a>
00035     ( <a class="code" href="classPLJPEGDecoder.html">PLJPEGDecoder</a> * pJPEGDecoder
00036     );
00037 <span class="comment"></span>
00038 <span class="comment">  //! Destroys a decoder.</span>
00039 <span class="comment"></span>  <span class="keyword">virtual</span> ~<a class="code" href="classPLPictDecoder.html">PLPictDecoder</a>
00040     ();
00041 <span class="comment"></span>
00042 <span class="comment">  //!</span>
00043 <span class="comment"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Open (<a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc);
00044 <span class="comment"></span>
00045 <span class="comment">  //! Fills the bitmap with the image.</span>
00046 <span class="comment"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classPLPictDecoder.html#a3">GetImage</a> (<a class="code" href="classPLBmpBase.html">PLBmpBase</a> &amp; Bmp);
00047 
00048 <span class="keyword">private</span>:
00049   <span class="comment">// Decodes header and version information.</span>
00050   <span class="comment">// Sets m_Version.</span>
00051   <span class="comment">// Performs checks to make sure the data is really a pict file.</span>
00052   <span class="keywordtype">void</span> readHeader
00053     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc,
00054       <span class="keywordtype">int</span>&amp; Version
00055     );
00056 
00057   <span class="comment">// This is the main decoder loop. The functions reads opcodes,</span>
00058   <span class="comment">// skips some of them, and hands the rest to opcode-specific</span>
00059   <span class="comment">// functions. It stops decoding after the first opcode containing</span>
00060   <span class="comment">// bitmapped data.</span>
00061   <span class="keywordtype">void</span> interpretOpcodes
00062     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc,
00063       <span class="keywordtype">int</span>&amp; Version
00064     );
00065 
00066   <span class="comment">// Moves to an even byte position in the file and returns the</span>
00067   <span class="comment">// opcode found there.</span>
00068   PLWORD readOpcode
00069     ( <span class="keywordtype">int</span> Version,
00070       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00071     );
00072 
00073   <span class="comment">// Opcode functions</span>
00074 
00075   <span class="comment">// Skips clipping rectangle or region opcode.</span>
00076   <span class="keywordtype">void</span> clip
00077     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00078     );
00079 
00080   <span class="comment">// Skips pattern definition opcode.</span>
00081   <span class="comment">// Untested!!</span>
00082   <span class="keywordtype">void</span> pixPat
00083     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00084     );
00085 
00086   <span class="comment">// Skips polygon/region opcodes.</span>
00087   <span class="comment">// Untested!!</span>
00088   <span class="keywordtype">void</span> skipPolyOrRegion
00089     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00090     );
00091 
00092   <span class="comment">// Opcode: Bitmap/pixmap data clipped by a rectangle.</span>
00093   <span class="keywordtype">void</span> bitsRect
00094     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00095     );
00096 
00097   <span class="comment">// Opcode: Bitmap/pixmap data clipped by a region.</span>
00098   <span class="keywordtype">void</span> bitsRegion
00099     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00100     );
00101 
00102   <span class="comment">// DirectBitsRect opcode.</span>
00103   <span class="keywordtype">void</span> opcode9a
00104     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00105     );
00106 
00107   <span class="keywordtype">void</span> DecodeOp9a
00108     ( <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00109       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00110     );
00111 
00112   <span class="comment">// Long comment opcode. Skipped.</span>
00113   <span class="keywordtype">void</span> longComment
00114     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00115     );
00116 
00117   <span class="comment">// Header opcode. Contains resolution information.</span>
00118   <span class="keywordtype">void</span> headerOp
00119     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00120     );
00121 
00122   <span class="comment">// JPEG opcode. Invoke the JPEG decoder for this PICT.</span>
00123   <span class="keywordtype">void</span> jpegOp
00124     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00125     );
00126 
00127   <span class="keywordtype">void</span> DecodeJPEG
00128     ( <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00129       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00130     );
00131 
00132   <span class="comment">// Bitmap &amp; Pixmap functions.</span>
00133 
00134   <span class="comment">// Allocates the output bitmap.</span>
00135   <span class="keywordtype">void</span> setBmpInfo
00136     ( MacpixMap PixMap
00137     );
00138 
00139   <span class="comment">// Decode version 1 bitmap: 1 bpp.</span>
00140   <span class="keywordtype">void</span> doBitmap
00141     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00142     );
00143 
00144   <span class="keywordtype">void</span> DecodeBitmap
00145     ( <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00146       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00147     );
00148 
00149   <span class="comment">// Decode version 2 pixmap.</span>
00150   <span class="keywordtype">void</span> doPixmap
00151     ( <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00152     );
00153 
00154   <span class="keywordtype">void</span> DecodePixmap
00155     ( <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00156       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00157     );
00158 
00159 
00160   <span class="comment">// This routine decompresses BitsRects with a packType of 4 (and</span>
00161   <span class="comment">// 32 bits per pixel). In this format, each line is separated</span>
00162   <span class="comment">// into 8-bit-bitplanes and then compressed via RLE. To decode,</span>
00163   <span class="comment">// the routine decompresses each line &amp; then juggles the bytes</span>
00164   <span class="comment">// around to get pixel-oriented data.</span>
00165   <span class="keywordtype">void</span> unpack32bits
00166     ( MacRect* pBounds,
00167       PLWORD rowBytes,
00168       <span class="keywordtype">int</span> NumBitPlanes,    <span class="comment">// 3 if RGB, 4 if RGBA</span>
00169       <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00170       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00171     );
00172 
00173   <span class="comment">// Decompression routine for 8 bpp. rowBytes is the number of</span>
00174   <span class="comment">// bytes each source row would take if it were uncompressed.</span>
00175   <span class="comment">// This _isn't_ equal to the number of pixels in the row - apple</span>
00176   <span class="comment">// pads the data to a word boundary and then compresses it. Of</span>
00177   <span class="comment">// course, we have to decompress the excess data and then throw it</span>
00178   <span class="comment">// away.</span>
00179   <span class="keywordtype">void</span> unpack8bits
00180     ( MacRect* pBounds,
00181       PLWORD rowBytes,
00182       <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00183       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00184     );
00185 
00186   <span class="comment">// Decompression routine for everything but 32 bpp. This routine</span>
00187   <span class="comment">// is slower than the two routines above since it has to deal</span>
00188   <span class="comment">// with a lot of special cases.</span>
00189   <span class="keywordtype">void</span> unpackbits
00190     ( MacRect* pBounds,
00191       PLWORD rowBytes,
00192       <span class="keywordtype">int</span> pixelSize,         <span class="comment">// Source bits per pixel.</span>
00193       <a class="code" href="classPLBmpBase.html">PLBmpBase</a> * pBmp,
00194       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00195     );
00196 
00197   <span class="comment">// Skips unneeded packbits.</span>
00198   <span class="keywordtype">void</span> skipBits
00199     ( MacRect* pBounds,
00200       PLWORD rowBytes,
00201       <span class="keywordtype">int</span> pixelSize,         <span class="comment">// Source bits per pixel.</span>
00202       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00203     );
00204 
00205   <span class="comment">// Expands one RLE unit to 32-bit pixel data.</span>
00206   <span class="keywordtype">void</span> expandBuf
00207     ( PLBYTE * pDestBuf,
00208       PLBYTE * pSrcBuf,
00209       <span class="keywordtype">int</span> Width,       <span class="comment">// Width in bytes for 8 bpp or less.</span>
00210                        <span class="comment">// Width in pixels for 16 bpp.</span>
00211       <span class="keywordtype">int</span> bpp          <span class="comment">// bits per pixel</span>
00212     );
00213 
00214   <span class="comment">// Expands Width units to 8-bit pixel data.</span>
00215   <span class="comment">// Max. 8 bpp source format.</span>
00216   <span class="keywordtype">void</span> expandBuf8
00217     ( PLBYTE * pDestBuf,
00218       PLBYTE * pSrcBuf,
00219       <span class="keywordtype">int</span> Width,       <span class="comment">// Width in bytes.</span>
00220       <span class="keywordtype">int</span> bpp          <span class="comment">// bits per pixel.</span>
00221     );
00222 
00223   <span class="keywordtype">void</span> readPixmap
00224     ( MacpixMap * pPixMap,
00225       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00226     );
00227 
00228   <span class="comment">// Reads a mac colour table into a windows palette.</span>
00229   <span class="keywordtype">void</span> readColourTable
00230     ( PLWORD * pNumColors,
00231       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc,
00232       <a class="code" href="classPLPixel32.html">PLPixel32</a> * pPal
00233     );
00234 
00235   <span class="keywordtype">void</span> readRect
00236     ( MacRect * pr,
00237       <a class="code" href="classPLDataSource.html">PLDataSource</a> * pDataSrc
00238     );
00239 
00240   <span class="keywordtype">void</span> dumpRect
00241     ( <span class="keywordtype">char</span> * psz,
00242       MacRect * pr
00243     );
00244 
00245   <span class="keywordtype">void</span> tracePixMapHeader
00246     ( <span class="keywordtype">int</span> Level,
00247       MacpixMap * pPixMap
00248     );
00249 
00250 
00251   <a class="code" href="classPLJPEGDecoder.html">PLJPEGDecoder</a> * m_pJPEGDecoder; <span class="comment">// Used if a pict file contains a JPEG.</span>
00252 
00253   <span class="keyword">enum</span> PICTType {none, op9a, jpeg, pixmap, bitmap};
00254   PICTType m_PictType;
00255 
00256   <span class="comment">// Pixmap header.</span>
00257   MacpixMap m_PixMap;
00258 
00259   <span class="comment">// pixmap/bitmap stuff</span>
00260   <span class="keywordtype">int</span> m_rowBytes;
00261   MacRect m_Bounds;
00262   <span class="keywordtype">bool</span> m_bIsRegion;
00263 };
00264 
00265 <span class="preprocessor">#endif</span>
00266 <span class="preprocessor"></span><span class="comment">/*</span>
00267 <span class="comment">/--------------------------------------------------------------------</span>
00268 <span class="comment">|</span>
00269 <span class="comment">|      $Log: plpictdec_8h-source.html,v $
00269 <span class="comment">|      Revision 1.4  2004/09/15 15:26:32  uzadow
00269 <span class="comment">|      Linux compatibility changes, doc update.
00269 <span class="comment">|</span>
00270 <span class="comment">|      Revision 1.10  2004/06/19 16:49:07  uzadow</span>
00271 <span class="comment">|      Changed GetImage so it works with PLBmpBase</span>
00272 <span class="comment">|</span>
00273 <span class="comment">|      Revision 1.9  2004/06/06 12:56:38  uzadow</span>
00274 <span class="comment">|      Doxygenified documentation.</span>
00275 <span class="comment">|</span>
00276 <span class="comment">|      Revision 1.8  2002/08/04 21:20:41  uzadow</span>
00277 <span class="comment">|      no message</span>
00278 <span class="comment">|</span>
00279 <span class="comment">|      Revision 1.7  2002/08/04 20:08:01  uzadow</span>
00280 <span class="comment">|      Added PLBmpInfo class, ability to extract metainformation from images without loading the whole image and proper greyscale support.</span>
00281 <span class="comment">|</span>
00282 <span class="comment">|      Revision 1.6  2002/03/31 13:36:42  uzadow</span>
00283 <span class="comment">|      Updated copyright.</span>
00284 <span class="comment">|</span>
00285 <span class="comment">|      Revision 1.5  2001/10/21 17:12:40  uzadow</span>
00286 <span class="comment">|      Added PSD decoder beta, removed BPPWanted from all decoders, added PLFilterPixel.</span>
00287 <span class="comment">|</span>
00288 <span class="comment">|      Revision 1.4  2001/10/16 17:12:26  uzadow</span>
00289 <span class="comment">|      Added support for resolution information (Luca Piergentili)</span>
00290 <span class="comment">|</span>
00291 <span class="comment">|      Revision 1.3  2001/10/06 22:03:26  uzadow</span>
00292 <span class="comment">|      Added PL prefix to basic data types.</span>
00293 <span class="comment">|</span>
00294 <span class="comment">|      Revision 1.2  2001/10/03 13:58:21  uzadow</span>
00295 <span class="comment">|      Removed references to config.h</span>
00296 <span class="comment">|</span>
00297 <span class="comment">|      Revision 1.1  2001/09/16 19:03:22  uzadow</span>
00298 <span class="comment">|      Added global name prefix PL, changed most filenames.</span>
00299 <span class="comment">|</span>
00300 <span class="comment">|</span>
00301 <span class="comment">\--------------------------------------------------------------------</span>
00302 <span class="comment">*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Sep 13 16:16:40 2004 for paintlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
